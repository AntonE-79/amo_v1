<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMO CRM - –ê–Ω–∞–ª–∏–∑ —Å–¥–µ–ª–æ–∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        select {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø:</h2>
    
    <select id="menu">
        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
        <option value="L1">L1</option>
        <option value="TP">–¢–ü</option>
        <option value="Dealer">–î–∏–ª–µ—Ä</option>
    </select>
    
    <div id="result" class="result"></div>

    <script>
        const menu = document.getElementById("menu");
        const resultBlock = document.getElementById("result");

        menu.addEventListener("change", async function() {
            const selectedValue = this.value;
            resultBlock.innerHTML = ""; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

            if (selectedValue === "L1") {
                resultBlock.textContent = "–í—ã–±—Ä–∞–Ω–æ: L1";
            } 
            else if (selectedValue === "Dealer") {
                resultBlock.textContent = "–í—ã–±—Ä–∞–Ω–æ: –î–∏–ª–µ—Ä";
            }
            else if (selectedValue === "TP") {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                resultBlock.innerHTML = "<div class='loading'>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ AMO CRM...</div>";
                
                try {
                    // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ AMO CRM API
                    const dealsCount = await fetchAmoCrmDeals();
                    resultBlock.innerHTML = `
                        <strong>–°—Ç–∞—Ç—É—Å –¢–ü:</strong><br>
                        –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫ –≤ CRM: <b>${dealsCount}</b>
                    `;
                } catch (error) {
                    resultBlock.innerHTML = `<div class='error'>–û—à–∏–±–∫–∞: ${error.message}</div>`;
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ AMO CRM API
        async function fetchAmoCrmDeals() {
            // üî¥ –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–≤–æ–∏!
            //const API_KEY = "–≤–∞—à_api_–∫–ª—é—á";
            //const DOMAIN = "camerussia.amocrm.ru";
            //const ACCESS_TOKEN = "–≤–∞—à_access_token";

            // const url = `https://${DOMAIN}/api/v4/leads`;
            // const url = 'https://camerussia.amocrm.ru/api/v4/leads'
            const url = `https://antone-79.github.io/amo_v1/`;
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
            }

            const data = await response.json();
            return data._embedded.leads.length; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ª-–≤–æ —Å–¥–µ–ª–æ–∫
        }
    </script>
</body>
</html>
